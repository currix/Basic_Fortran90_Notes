<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Fortran 90 Lessons for Computational Chemistry - Subprograms (I): FUNCTIONS</title>

<link href="index.html" rel="start">
<link href="ch-clase_6.html" rel="prev">
<link href="ch-clase_9.html" rel="next">
<link href="index.html#contents" rel="contents">
<link href="index.html#copyright" rel="copyright">
<link href="ch-clase_1.html" rel="chapter" title="1 Introduction">
<link href="ch-clase_2.html" rel="chapter" title="2 Basic Operations">
<link href="ch-clase_3.html" rel="chapter" title="3 Introduction to Fortran Arrays">
<link href="ch-clase_4.html" rel="chapter" title="4 More on Arrays">
<link href="ch-clase_7.html" rel="chapter" title="5 Control Structures">
<link href="ch-clase_5.html" rel="chapter" title="6 INPUT/OUTPUT (I)">
<link href="ch-clase_6.html" rel="chapter" title="7 Input/Output (II)">
<link href="ch-clase_8.html" rel="chapter" title="8 Subprograms (I): FUNCTIONS">
<link href="ch-clase_9.html" rel="chapter" title="9 Subprogramas (II): subrutinas">
<link href="ch-clase_10.html" rel="chapter" title="10 Subprogramas (III): módulos">
<link href="ch-clase_11.html" rel="chapter" title="11 Subprogramas (IV)">
<link href="ch-clase_blaslap.html" rel="chapter" title="12 Instalación y uso de las bibliotecas BLAS y LAPACK">
<link href="ch-cap_ref.html" rel="chapter" title="13 Referencias">
<link href="ch-clase_1.html#s-sec_11" rel="section" title="1.1 Objectives">
<link href="ch-clase_1.html#s-sec_12" rel="section" title="1.2 Main items.">
<link href="ch-clase_1.html#s-sec_13" rel="section" title="1.3 Example Codes.">
<link href="ch-clase_2.html#s-sec_21" rel="section" title="2.1 Objectives">
<link href="ch-clase_2.html#s-sec_22" rel="section" title="2.2 Main items.">
<link href="ch-clase_2.html#s-sec_23" rel="section" title="2.3 Example Codes.">
<link href="ch-clase_3.html#s-sec_31" rel="section" title="3.1 Objectivos">
<link href="ch-clase_3.html#s-sec_32" rel="section" title="3.2 Main items.">
<link href="ch-clase_3.html#s-sec_33" rel="section" title="3.3 Example Codes.">
<link href="ch-clase_4.html#s-sec_41" rel="section" title="4.1 Objectives">
<link href="ch-clase_4.html#s-sec_42" rel="section" title="4.2 Main items.">
<link href="ch-clase_4.html#s-sec_43" rel="section" title="4.3 Example Codes.">
<link href="ch-clase_7.html#s-sec_71" rel="section" title="5.1 Objectives">
<link href="ch-clase_7.html#s-sec_72" rel="section" title="5.2 Main items.">
<link href="ch-clase_7.html#s-sec_73" rel="section" title="5.3 Example codes.">
<link href="ch-clase_5.html#s-sec_51" rel="section" title="6.1 Objectivos">
<link href="ch-clase_5.html#s-sec_52" rel="section" title="6.2 Main Items.">
<link href="ch-clase_5.html#s-sec_53" rel="section" title="6.3 Example Codes">
<link href="ch-clase_6.html#s-sec_61" rel="section" title="7.1 Objectives">
<link href="ch-clase_6.html#s-sec_62" rel="section" title="7.2 Main items.">
<link href="ch-clase_6.html#s-sec_63" rel="section" title="7.3 Example Codes">
<link href="ch-clase_8.html#s-sec_81" rel="section" title="8.1 Objectives">
<link href="ch-clase_8.html#s-sec_82" rel="section" title="8.2 Main items.">
<link href="ch-clase_8.html#s-sec_83" rel="section" title="8.3 Example Codes">
<link href="ch-clase_9.html#s-sec_91" rel="section" title="9.1 Objetivos">
<link href="ch-clase_9.html#s-sec_92" rel="section" title="9.2 Puntos destacables.">
<link href="ch-clase_9.html#s-sec_93" rel="section" title="9.3 Programas usados como ejemplo.">
<link href="ch-clase_10.html#s-sec_101" rel="section" title="10.1 Objetivos">
<link href="ch-clase_10.html#s-sec_102" rel="section" title="10.2 Puntos destacables.">
<link href="ch-clase_10.html#s-sec_103" rel="section" title="10.3 Programas usados como ejemplo.">
<link href="ch-clase_11.html#s-sec_111" rel="section" title="11.1 Objetivos">
<link href="ch-clase_11.html#s-sec_112" rel="section" title="11.2 Puntos destacables.">
<link href="ch-clase_11.html#s-sec_113" rel="section" title="11.3 Programas usados como ejemplo.">
<link href="ch-clase_blaslap.html#s-sec_bl1" rel="section" title="12.1 Objetivos">
<link href="ch-clase_blaslap.html#s-sec_bl2" rel="section" title="12.2 Puntos destacables.">
<link href="ch-clase_blaslap.html#s-sec_bl3" rel="section" title="12.3 Programas usados como ejemplo.">
<link href="ch-clase_1.html#s-sec_p_1_1" rel="subsection" title="1.3.1 excode_1_1.f90">
<link href="ch-clase_1.html#s-sec_p_1_2" rel="subsection" title="1.3.2 excode_1_2.f90">
<link href="ch-clase_2.html#s-sec_p_2_1" rel="subsection" title="2.3.1 excode_2_1.f90">
<link href="ch-clase_2.html#s-sec_p_2_2" rel="subsection" title="2.3.2 excode_2_2.f90">
<link href="ch-clase_2.html#s-sec_p_2_3" rel="subsection" title="2.3.3 excode_2_3.f90">
<link href="ch-clase_2.html#s-sec_p_2_4" rel="subsection" title="2.3.4 excode_2_4.f90">
<link href="ch-clase_2.html#s-sec_p_2_5" rel="subsection" title="2.3.5 excode_2_5.f90">
<link href="ch-clase_2.html#s-sec_p_2_6" rel="subsection" title="2.3.6 excode_2_6.f90">
<link href="ch-clase_3.html#s-sec_p_3_1" rel="subsection" title="3.3.1 excode_3_1.f90">
<link href="ch-clase_3.html#s-sec_p_3_2" rel="subsection" title="3.3.2 excode_3_2.f90">
<link href="ch-clase_3.html#s-sec_p_3_3" rel="subsection" title="3.3.3 excode_3_3.f90">
<link href="ch-clase_3.html#s-sec_p_3_4" rel="subsection" title="3.3.4 excode_3_4.f90">
<link href="ch-clase_4.html#s-sec_p_4_1" rel="subsection" title="4.3.1 excode_4_1.f90">
<link href="ch-clase_4.html#s-sec_p_4_2" rel="subsection" title="4.3.2 excode_4_2.f90">
<link href="ch-clase_4.html#s-sec_p_4_3" rel="subsection" title="4.3.3 excode_4_3.f90">
<link href="ch-clase_4.html#s-sec_p_4_4" rel="subsection" title="4.3.4 excode_4_4.f90">
<link href="ch-clase_4.html#s-sec_p_4_5" rel="subsection" title="4.3.5 excode_4_5.f90">
<link href="ch-clase_4.html#s-sec_p_4_6" rel="subsection" title="4.3.6 excode_4_6.f90">
<link href="ch-clase_7.html#s-sec_p_7_1" rel="subsection" title="5.3.1 excode_5_1.f90">
<link href="ch-clase_7.html#s-sec_p_7_2" rel="subsection" title="5.3.2 excode_5_2.f90">
<link href="ch-clase_7.html#s-sec_p_7_3" rel="subsection" title="5.3.3 excode_5_3.f90">
<link href="ch-clase_7.html#s-sec_p_7_4" rel="subsection" title="5.3.4 Programa ejemplo_5_4.f90">
<link href="ch-clase_5.html#s-sec_p_5_1" rel="subsection" title="6.3.1 excode_6_1.f90">
<link href="ch-clase_5.html#s-sec_p_5_2" rel="subsection" title="6.3.2 excode_6_2.f90">
<link href="ch-clase_5.html#s-sec_p_5_3" rel="subsection" title="6.3.3 excode_6_3.f90">
<link href="ch-clase_5.html#s-sec_p_5_4" rel="subsection" title="6.3.4 excode_6_4.f90">
<link href="ch-clase_5.html#s-sec_p_5_5" rel="subsection" title="6.3.5 excode_6_5.f90">
<link href="ch-clase_5.html#s-sec_p_5_6" rel="subsection" title="6.3.6 excode_6_6.f90">
<link href="ch-clase_5.html#s-sec_p_5_7" rel="subsection" title="6.3.7 excode_6_7.f90">
<link href="ch-clase_6.html#s-sec_p_6_1" rel="subsection" title="7.3.1 Programa ejemplo_7_1.f90">
<link href="ch-clase_6.html#s-sec_p_6_2" rel="subsection" title="7.3.2 excode_7_2.f90">
<link href="ch-clase_6.html#s-sec_p_6_22" rel="subsection" title="7.3.3 Script ej_here_file">
<link href="ch-clase_6.html#s-sec_p_6_3" rel="subsection" title="7.3.4 excode_7_3.f90">
<link href="ch-clase_6.html#s-sec_p_6_32" rel="subsection" title="7.3.5 namelist input file">
<link href="ch-clase_6.html#s-sec_p_6_4" rel="subsection" title="7.3.6 excode_7_4.f90">
<link href="ch-clase_8.html#s-sec_p_8_1" rel="subsection" title="8.3.1 excode_8_1.f90">
<link href="ch-clase_8.html#s-sec_p_8_2" rel="subsection" title="8.3.2 excode_8_2.f90">
<link href="ch-clase_8.html#s-sec_p_8_3" rel="subsection" title="8.3.3 Programa ejemplo_8_3.f90">
<link href="ch-clase_8.html#s-sec_p_8_4" rel="subsection" title="8.3.4 Programa ejemplo_8_4.f90">
<link href="ch-clase_8.html#s-sec_p_8_5" rel="subsection" title="8.3.5 excode_8_5.f90">
<link href="ch-clase_8.html#s-sec_p_8_6" rel="subsection" title="8.3.6 excode_8_6.f90">
<link href="ch-clase_8.html#s-sec_p_8_7" rel="subsection" title="8.3.7 excode_8_7.f90">
<link href="ch-clase_9.html#s-sec_p_9_1" rel="subsection" title="9.3.1 Programa ejemplo_9_1.f90">
<link href="ch-clase_9.html#s-sec_p_9_2" rel="subsection" title="9.3.2 Programa ejemplo_9_2.f90">
<link href="ch-clase_9.html#s-sec_p_9_3" rel="subsection" title="9.3.3 Programa ejemplo_9_3.f90">
<link href="ch-clase_9.html#s-sec_p_9_4" rel="subsection" title="9.3.4 Programa ejemplo_9_4.f90">
<link href="ch-clase_9.html#s-sec_p_9_5" rel="subsection" title="9.3.5 Programa ejemplo_9_5.f90">
<link href="ch-clase_9.html#s-sec_p_9_6" rel="subsection" title="9.3.6 Programa ejemplo_9_6.f90">
<link href="ch-clase_9.html#s-sec_p_9_7" rel="subsection" title="9.3.7 Programa ejemplo_9_7.f90">
<link href="ch-clase_10.html#s-sec_p_10_1" rel="subsection" title="10.3.1 Programa ejemplo_10_1.f90">
<link href="ch-clase_10.html#s-sec_p_10_2" rel="subsection" title="10.3.2 Programa ejemplo_10_2.f90">
<link href="ch-clase_10.html#s-sec_p_10_3" rel="subsection" title="10.3.3 Programa ejemplo_10_3.f90">
<link href="ch-clase_10.html#s-sec_p_10_4" rel="subsection" title="10.3.4 Programa ejemplo_10_4.f90">
<link href="ch-clase_11.html#s-sec_p_11_1" rel="subsection" title="11.3.1 Programa ejemplo_11_1.f90">
<link href="ch-clase_11.html#s-sec_p_11_2" rel="subsection" title="11.3.2 Programa ejemplo_11_2.f90">
<link href="ch-clase_11.html#s-sec_p_11_3" rel="subsection" title="11.3.3 Programa ejemplo_11_3.f90">
<link href="ch-clase_11.html#s-sec_p_11_4" rel="subsection" title="11.3.4 Programa ejemplo_11_4.f90">
<link href="ch-clase_blaslap.html#s-sec_p_bl_1" rel="subsection" title="12.3.1 Ejemplo de fichero make.inc para LAPACK">
<link href="ch-clase_blaslap.html#s-sec_p_bl_2" rel="subsection" title="12.3.2 Ejemplo de fichero make.inc para LAPACK95">
<link href="ch-clase_blaslap.html#s-sec_p_bl_3" rel="subsection" title="12.3.3 Ejemplo de programa que invoca LAPACK95">
<link href="ch-clase_blaslap.html#s-sec_p_bl_4" rel="subsection" title="12.3.4 Ejemplo de makefile para compilar programas que invocan LAPACK95">

</head>

<body>

<p><a name="ch-clase_8"></a></p>
<hr>

<p>
[ <a href="ch-clase_6.html">previous</a> ]
[ <a href="index.html#contents">Contents</a> ]
[ <a href="ch-clase_1.html">1</a> ]
[ <a href="ch-clase_2.html">2</a> ]
[ <a href="ch-clase_3.html">3</a> ]
[ <a href="ch-clase_4.html">4</a> ]
[ <a href="ch-clase_7.html">5</a> ]
[ <a href="ch-clase_5.html">6</a> ]
[ <a href="ch-clase_6.html">7</a> ]
[ 8 ]
[ <a href="ch-clase_9.html">9</a> ]
[ <a href="ch-clase_10.html">10</a> ]
[ <a href="ch-clase_11.html">11</a> ]
[ <a href="ch-clase_blaslap.html">12</a> ]
[ <a href="ch-cap_ref.html">13</a> ]
[ <a href="ch-clase_9.html">next</a> ]
</p>

<hr>

<h1>
<code>Fortran 90</code> Lessons for Computational Chemistry
<br>Chapter 8 - Subprograms (I): FUNCTIONS
</h1>

<hr>

<h2 id="s-sec_81">8.1 Objectives</h2>

<p>
The main aims of this lesson are the following:
</p>
<ol type="1" start="1" >
<li>
<p>
presenting the advantages of using functions, subroutines and modules.
</p>
</li>
</ol>
<ol type="1" start="2" >
<li>
<p>
presenting the function concept in <code>Fortran</code>.
</p>
</li>
</ol>
<ol type="1" start="3" >
<li>
<p>
showing the different types of functions: intrinsic, generic, elemental,
transformational, and internal.
</p>
</li>
</ol>
<ol type="1" start="4" >
<li>
<p>
making possible the definition of new functions by the user.
</p>
</li>
</ol>
<ol type="1" start="5" >
<li>
<p>
evinving the difference beyween external and internal functions.
</p>
</li>
</ol>

<p>
The use of subporgrams allows a more structured and efficient programming owing
to
</p>
<ul>
<li>
<p>
the possibility of developing and testing different subtasks in an independent
manner.
</p>
</li>
</ul>
<ul>
<li>
<p>
it makes possible to recycle subprograms in different programs, diminishing the
necessary time for coding.
</p>
</li>
</ul>
<ul>
<li>
<p>
the isolation in different subtasks of possible errors and the minimization of
unexpected side effects, due to variable encapsulation.
</p>
</li>
</ul>

<hr>

<h2 id="s-sec_82">8.2 Main items.</h2>

<p>
We first focus in functions and will follow with subroutines and modules.
</p>
<ul>
<li>
<p>
General characteristics of functions.
</p>

<p>
The main characteristics of a function are:
</p>
<ul>
<li>
<p>
May require the input of one or several arguments.
</p>
</li>
</ul>
<ul>
<li>
<p>
Arguments can take the form of an expression.
</p>
</li>
</ul>
<ul>
<li>
<p>
In general, a function produces a single output, which is a function of the
arguments, and this output is of scalar type though in some cases it also can
be of an array type.
</p>
</li>
</ul>
<ul>
<li>
<p>
The arguments can be of different types.
</p>
</li>
</ul>

<p>
There are more than one hundred predefined functions in <code>Fortran</code>,
highly tested, and of easy usage.  E.g.  we need trigonometric functions we can
make use of the following:
</p>
<ul>
<li>
<p>
<samp>Y = SIN(X)</samp>
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>Y = COS(X)</samp>
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>Y = TAN(X)</samp>
</p>
</li>
</ul>

<p>
where <samp>X</samp> and <samp>Y</samp> are real variables[<a
href="footnotes.html#f10" name="fr10">10</a>]
</p>

<p>
This predefined functions are called <em>intrinsic functions</em>.  In this
link <code><a
href="http://gcc.gnu.org/onlinedocs/gfortran/Intrinsic-Procedures.html#Intrinsic-Procedures">URL</a></code>
you can find a complet list of the intrinsic functions at your disposal with
the <code>gfortran</code> compiler.
</p>

<p>
In general intrinsic functions are also <em>generic</em>, which means that they
can admit different argument types, with the exception of the functions
<samp>LGE</samp>, <samp>LGT</samp>, <samp>LLE</samp>, and <samp>LLT</samp>.
</p>
</li>
</ul>
<ul>
<li>
<p>
The <em>elemental</em> functions may have as an argument both scalars or
vectors.  The example source codes <a
href="#s-sec_p_8_1"><samp>excode_8_1.f90</samp>, Section 8.3.1</a> and <a
href="#s-sec_p_8_2"><samp>excode_8_2.f90</samp>, Section 8.3.2</a> show the
elemental and generic character of some intrinsic functions.  When an elemental
function is applied to an array the fucntions is applied to each array element.
</p>
</li>
</ul>
<ul>
<li>
<p>
Other type of functions are of <em>inquiry</em> type, giving information about
the characterictics of an array, e.g.  the <samp>SIZE</samp> and
<samp>ALLOCATED</samp> functions.  Examples of the latter are found in <a
href="ch-clase_5.html#s-sec_p_5_7"><samp>excode_6_7.f90</samp>, Section
6.3.7</a> and <a href="ch-clase_9.html#s-sec_p_9_3">Programa ejemplo_9_3.f90,
Section 9.3.3</a>.
</p>

<p>
The <em>transformational</em> functions transform between different data types,
e.g.  <samp>REAL</samp> and <samp>TRANSPOSE</samp>, or functions that work with
time data variables as <samp>SYSTEM_CLOCK</samp> and
<samp>DATE_AND_TIME</samp>.
</p>
</li>
</ul>
<ul>
<li>
<p>
Conversion between data types:
</p>
<ul>
<li>
<p>
<samp>REAL(i)</samp>: integer <samp>i</samp> is converted to a float.  The
argument <samp>i</samp> can be an integer, a double precision real or a complex
number.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>INT(x)</samp>: transforms the real variable <samp>x</samp> to an integer,
truncating the decimal part.  No rounding is performed.  The <samp>x</samp>
variable can be a real, double precision real, or a complex variable.
</p>
</li>
</ul>
<ul>
<li>
<p>
The functions that follow allow to transform from real to integer values with
an adequate control:
</p>
<ul>
<li>
<p>
<samp>CEILING(x)</samp>: real value <samp>x</samp> to the minimum integer value
larger than or equal than <samp>x</samp>.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>FLOOR(x)</samp>: real value <samp>x</samp> to the maximum integer value
less than or equal than <samp>x</samp>.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>NINT(x)</samp>: round the real value <samp>x</samp> to the nearest
integer.
</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>
<samp>DBLE(a)</samp>: transforms <samp>a</samp> to double precision.  The
argument can be integer, real, or complex.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>CMPLX(x)</samp> or <samp>CMPLX(x,y)</samp>: transform to complex values,
where the second argument is the imaginary part.
</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>
Además de las funciones intrínsecas, pueden definirse funciones.  La definición
de una función implica por una parte la propia definición y la posterior
llamada a la función desde un programa.  La definición de una función sigue el
siguiente esquema:
</p>

<pre>
     FUNCTION <var>fun_name</var>(<var>argument_list</var>)
       IMPLICIT NONE
       Declaration section (including arguments and fun_name)
       ....
       Local variables declaration
       ....
       <var>fun_name</var> = expr
       RETURN ! Optional
     END FUNCTION <var>fun_name</var>
</pre>

<p>
En el ejemplo <a href="#s-sec_p_8_3">Programa ejemplo_8_3.f90, Section
8.3.3</a> se muestra como se define e invoca una función que calcula el máximo
común divisor de dos números enteros.  Es importante tener en cuenta lo
siguiente:
</p>
<ul>
<li>
<p>
En este ejemplo podemos distinguir dos bloques.  Un primer bloque con el
programa principal y un segundo bloque donde se define la función.  De hecho la
función puede definirse en un fichero diferente al programa principal, y dar
ambos ficheros al compilador para que prepare el programa ejecutable.
</p>
</li>
</ul>
<ul>
<li>
<p>
Es importante tener en cuenta que las variables definidas en la función tienen
carácter local respecto a las variables que se definen en el programa.
</p>
</li>
</ul>
<ul>
<li>
<p>
La función en este caso tiene como nombre <samp>MCD</samp> y su tipo es
<samp>INTEGER</samp>.  Por tanto, el programa espera que el valor que dé la
función como resultado sea un entero.
</p>
</li>
</ul>
<ul>
<li>
<p>
El atributo <samp>INTENT(IN)</samp> en la definición de las variables
<samp>A</samp> y <samp>B</samp> de la función:
</p>

<pre>
     INTEGER , INTENT(IN) :: A,B
</pre>

<p>
indica que dichas variables son variables de entrada y sus valores no pueden
ser modificados por la función.
</p>
</li>
</ul>

<p>
Todos los argumentos de una función deben tener este atributo para evitar que
inadvertidamente sus valores se modifiquen al evaluar la función.
</p>
</li>
</ul>
<ul>
<li>
<p>
Es posible definir funciones que sean <em>internas</em>, esto es, que se
restrinjan a un determinado segmento de código, y no puedan ser llamadas desde
otro punto del programa.  Para ello se utiliza la orden <samp>CONTAINS</samp>
como en los ejemplos <a href="#s-sec_p_8_4">Programa ejemplo_8_4.f90, Section
8.3.4</a> y <a href="#s-sec_p_8_5"><samp>excode_8_5.f90</samp>, Section
8.3.5</a>.  El primero de estos dos programas define una función con la que
calcular la energía de un nivel vibracional teniendo en cuenta la frecuencia
<em>we</em> y la anarmonicidad <em>wexe</em>.  El segundo, dado un número
entero, calcula los factores primos de dicho número.  En este ejemplo <a
href="#s-sec_p_8_5"><samp>excode_8_5.f90</samp>, Section 8.3.5</a> podemos ver
también el uso de un bucle del tipo <em>REPEAT UNTIL</em>.
</p>
</li>
</ul>

<hr>

<h2 id="s-sec_83">8.3 Example Codes</h2>

<hr>

<h3 id="s-sec_p_8_1">8.3.1 <samp>excode_8_1.f90</samp></h3>

<pre>
     PROGRAM ex_8_1
       IMPLICIT NONE
       ! Variable Definition
       INTEGER, PARAMETER :: Long=SELECTED_REAL_KIND(18,310)
       !
       REAL (KIND=Long), PARAMETER :: DPI = ACOS(-1.0_Long) ! Pi number double precision
       REAL (KIND=Long) :: DANGLE, DANGLERAD
       !
       REAL, PARAMETER :: PI = ACOS(-1.0) ! Pi number single precision
       REAL :: ANGLERAD
       !
       PRINT*, 'ANGLE INPUT (Degrees)'
       READ*, DANGLE
       PRINT*
       ! Transform to  RAD
       DANGLERAD = DPI*DANGLE/180.0_Long
       ANGLERAD  = PI*DANGLE/180.0
       !
       PRINT 20, DANGLE, DANGLERAD
       PRINT 21, DANGLE, ANGLERAD
       PRINT*
       PRINT*
       !
       PRINT 22, DANGLERAD, SIN(DANGLERAD), COS(DANGLERAD), SIN(DANGLERAD)**2+COS(DANGLERAD)**2,&amp;
            1.0_Long-(SIN(DANGLERAD)**2+COS(DANGLERAD)**2) 
       PRINT*
       PRINT 22, ANGLERAD, SIN(ANGLERAD), COS(ANGLERAD), SIN(ANGLERAD)**2+COS(ANGLERAD)**2,1.0 - (SIN(ANGLERAD)**2+COS(ANGLERAD)**2) 
       !
     20 FORMAT (1X, 'An angle of ',F14.8,' degrees = ', F14.8, ' rad. (dp)')
     21 FORMAT (1X, 'An angle of ',F14.8,' degrees = ', F14.8, ' rad. (sp)')
     22 FORMAT (1X, 'ANGLE ',F14.8,', SIN = ', F13.9, ', COS =',F13.9,/'SIN**2+COS**2 = ', F18.14, ', 1 - SIN**2+COS**2 = ', F18.14)
     END PROGRAM EX_8_1
</pre>

<hr>

<h3 id="s-sec_p_8_2">8.3.2 <samp>excode_8_2.f90</samp></h3>

<pre>
     PROGRAM ex_8_2
       IMPLICIT NONE
       ! VARIABLE DEFINITION
       INTEGER , PARAMETER :: NEL=5
       REAL, PARAMETER :: PI = ACOS(-1.0) ! Pi number
       REAL, DIMENSION(1:NEL)   :: XR = (/ 0.0, PI/2.0, PI, 3.0*PI/2.0, 2.0*PI/)
       INTEGER , DIMENSION(1:NEL):: XI = (/ 0, 1, 2, 3, 4/)
       !
       PRINT*, 'Sin  ', XR, ' = ', SIN(XR)
       PRINT*, 'LOG10  ', XR, ' = ', LOG10(XR)
       PRINT*, 'REAL ', XI, ' = ', REAL(XI)
     END PROGRAM ex_8_2
</pre>

<hr>

<h3 id="s-sec_p_8_3">8.3.3 Programa ejemplo_8_3.f90</h3>

<pre>
     PROGRAM ex_8_3
       IMPLICIT NONE
       INTEGER :: I,J,Result
       INTEGER :: MCD
       EXTERNAL MCD
       PRINT *,' INTRODUCE TWO INTEGERS:'
       READ *,I,J
       RESULT = MCD(I,J)
       PRINT *,' THE GREATEST COMMON DIVISOR OF ',I,' AND ',J,' IS ',RESULT
     END PROGRAM ex_8_3
     !
     INTEGER FUNCTION MCD(A,B)
     IMPLICIT NONE
     INTEGER , INTENT(IN) :: A,B
     INTEGER :: Temp
       IF (A &lt; B) THEN
          Temp=A
       ELSE
          Temp=B
       ENDIF
       DO WHILE ((MOD(A,Temp) /= 0) .OR. (MOD(B,Temp) /=0))
          Temp=Temp-1
       END DO
       MCD=Temp
     END FUNCTION MCD
</pre>

<hr>

<h3 id="s-sec_p_8_4">8.3.4 Programa ejemplo_8_4.f90</h3>

<pre>
     PROGRAM ex_8_4
       IMPLICIT NONE
       ! Internal function example:
       ! E(v) = we (v+1/2) - wexe (v+1/2)**2.
       INTEGER :: V, VMAX
       REAL :: we, wexe, Energy
       PRINT *,' Vmax?:'
       READ *, VMAX
       PRINT *,' we and wexe?'
       READ *,we, wexe
       DO V = 0, VMAX
          Energy = FEN(V)
          PRINT 100, V, Energy
       ENDDO
     100 FORMAT(1X,'E(',I3,') = ',F14.6)
     CONTAINS 
     !
       REAL FUNCTION FEN(V)
         IMPLICIT NONE
         INTEGER , INTENT(IN) :: V
         FEN = we*(V+0.5)-wexe*(V+0.5)**2
       END FUNCTION FEN
     !
     END PROGRAM EX_8_4
</pre>

<hr>

<h3 id="s-sec_p_8_5">8.3.5 <samp>excode_8_5.f90</samp></h3>

<pre>
     PROGRAM ex_8_5
       !
       ! Simple program to compute the prime divisors of a given integer number.
       !
       IMPLICIT NONE
       INTEGER :: NUMVAL
       INTEGER :: NUM
       !
       READ*, NUMVAL ! input
       !
       DO
          NUM = QUOT(NUMVAL)
          IF (NUM == NUMVAL) THEN
             PRINT*, NUM
             EXIT
          ELSE
             PRINT*, NUMVAL/NUM, NUM
             NUMVAL = NUM
          ENDIF
       ENDDO
       !
     CONTAINS
       ! 
       INTEGER FUNCTION QUOT(NUM1)
         !
         INTEGER, INTENT(IN) :: NUM1
         INTEGER :: I
         !
         QUOT = NUM1
         !
         DO I = 2, NUM1-1
            IF (MOD(NUM1,I) == 0) THEN
               QUOT = NUM1/I
               EXIT
            ENDIF
         ENDDO
         !
       END FUNCTION QUOT
       !
     END PROGRAM ex_8_5
</pre>

<hr>

<h3 id="s-sec_p_8_6">8.3.6 <samp>excode_8_6.f90</samp></h3>

<pre>
     PROGRAM ex_8_6
       !
       ! Program to evaluate a 1D potential function on grid points
       !
       IMPLICIT NONE
       !
       REAL, DIMENSION(:), ALLOCATABLE :: X_grid, Pot_grid
       !
       REAL :: X_min, X_max, Delta_X
       REAL :: V_0 = 10.0, a_val = 1.0
       INTEGER :: Index, X_dim
       INTEGER :: Ierr
       !
       !
       INTERFACE Potf
          ELEMENTAL FUNCTION Potf(Depth, Inv_length, X)
            !
            IMPLICIT NONE
            !
            REAL, INTENT(IN) :: Depth, Inv_length, X
            REAL :: Potf
            !
          END FUNCTION Potf
       END INTERFACE Potf
       !
       !
       READ(*,*), X_min, X_max, X_dim ! input minimum and maximum values of X and number of points
       !
       ALLOCATE(X_grid(1:X_dim), STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'X_grid allocation failed'
       ENDIF
       !
       ALLOCATE(Pot_grid(1:X_dim), STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'Pot_grid allocation failed'
       ENDIF
       !
       !
       Delta_X = (X_max - X_min)/REAL(X_dim - 1)
       !
       X_grid = (/ (Index, Index = 0 , X_dim - 1 ) /)
       X_grid = X_min + Delta_X*X_grid
       !
       Pot_grid = Potf(V_0, a_val, X_grid)
       !
       DO Index = 1, X_dim
          PRINT*, X_grid, Pot_grid
       ENDDO
       !
       DEALLOCATE(X_grid, STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'X_grid deallocation failed'
       ENDIF
       !
       DEALLOCATE(Pot_grid, STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'Pot_grid deallocation failed'
       ENDIF
       !
       !
     END PROGRAM ex_8_6
     !
     ELEMENTAL FUNCTION Potf(Depth, Inv_length, X)
       !
       IMPLICIT NONE
       !
       REAL, INTENT(IN) :: Depth, Inv_length, X
       !
       REAL :: Potf
       !
       Potf = -Depth/(COSH(Inv_length*X)**2)
       !
     END FUNCTION Potf
</pre>

<hr>

<h3 id="s-sec_p_8_7">8.3.7 <samp>excode_8_7.f90</samp></h3>

<pre>
     PROGRAM ex_8_7
       !
       ! Program to characterize an array making use of inquiry functions
       !
       IMPLICIT NONE
       !
       REAL, DIMENSION(:,:), ALLOCATABLE :: X_grid
       INTEGER :: Ierr
       !
       ! 
       ALLOCATE(X_grid(-20:20,0:50), STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'X_grid allocation failed'
       ENDIF
       !
       WRITE(*, 100) SHAPE(X_grid)
     100 FORMAT(1X, &quot;Shape :        &quot;, 7I7)
       !
       WRITE(*, 110) SIZE(X_grid)
     110 FORMAT(1X, &quot;Size :         &quot;, I7)
       !
       WRITE(*, 120) LBOUND(X_grid)
     120 FORMAT(1X, &quot;Lower bounds : &quot;, 7I6)
       !
       WRITE(*, 130) UBOUND(X_grid)
     130 FORMAT(1X, &quot;Upper bounds : &quot;, 7I6)
       !
       DEALLOCATE(X_grid, STAT = Ierr)
       IF (Ierr /= 0) THEN
          STOP 'X_grid deallocation failed'
       ENDIF
       !
     END PROGRAM ex_8_7
</pre>

<hr>

<p>
[ <a href="ch-clase_6.html">previous</a> ]
[ <a href="index.html#contents">Contents</a> ]
[ <a href="ch-clase_1.html">1</a> ]
[ <a href="ch-clase_2.html">2</a> ]
[ <a href="ch-clase_3.html">3</a> ]
[ <a href="ch-clase_4.html">4</a> ]
[ <a href="ch-clase_7.html">5</a> ]
[ <a href="ch-clase_5.html">6</a> ]
[ <a href="ch-clase_6.html">7</a> ]
[ 8 ]
[ <a href="ch-clase_9.html">9</a> ]
[ <a href="ch-clase_10.html">10</a> ]
[ <a href="ch-clase_11.html">11</a> ]
[ <a href="ch-clase_blaslap.html">12</a> ]
[ <a href="ch-cap_ref.html">13</a> ]
[ <a href="ch-clase_9.html">next</a> ]
</p>

<hr>

<p>
<code>Fortran 90</code> Lessons for Computational Chemistry
</p>

<address>
0.0<br>
<br>
Curro Pérez-Bernal <code><a href="mailto:francisco.perez@dfaie.uhu.es">mailto:francisco.perez@dfaie.uhu.es</a></code><br>
<br>
</address>
<hr>

</body>

</html>

